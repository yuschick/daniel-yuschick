<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="theme-color" content="#bc3810"/>
<meta name="description" content="Joi does so many things well but falls short in providing custom error messages. This post shows that custom &amp; localised errors are not only possible but quite flexible."/>


    <link
      rel="shortcut icon"
      type="image/svg"
      href="/assets/logo-dy-initials.svg"/>
    <title>Building Custom &amp; Localised Error Messages with Joi | Daniel Yuschick</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Mono&family=Mulish:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles/main.css"/>

    

    

    
      <link rel="stylesheet" href="/styles/pages/article.css"/>
    
  </head>
  <body>
    <div id="root">
      <section>
  <a class="visually-hidden skip-to-link" href="#main-content">
    Skip to main content
  </a>

  <header class="primary-header">
    <svg viewBox="0 0 85 138" fill="none" xmlns="http://www.w3.org/2000/svg">
    <title>Daniel Yuschick Logo - Initials</title>
    <description>A logo design for Daniel Yuschick.</description>
    <path d="M12.1626 50.7282H21.8374L9.6748 87.2718H0L12.1626 50.7282Z" fill="#F5F3F4"/>
    <path d="M55.0164 50.7282H64.6912L52.5286 87.2718H42.8538L55.0164 50.7282Z" fill="#F5F3F4"/>
    <path d="M49.6259 0H59.3007L30.4145 87.2718H20.7397L49.6259 0Z" fill="#F5F3F4"/>
    <path d="M75.3251 50.7282H84.9999L56.1138 138H46.439L75.3251 50.7282Z" fill="#F5F3F4"/>
</svg>

  </header>
</section>
      <nav>
  <ul>
    <li >
      <a  href="/">About</a>
    </li>
    <li  data-current >
      <a  aria-current="page"  href="/articles">Articles</a>
    </li>
    <li >
      <a  href="/books">Books</a>
    </li>
    <li>
      <a
        href="https://twitter.com/DanielYuschick"
        title="Visit Daniel Yuschick on Twitter"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124-4.09-.193-7.715-2.157-10.141-5.126-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548z" fill="#fff"/></svg>
      </a>
    </li>
  </ul>
</nav>
      <main id="main-content">
<article>
    <h1>Building Custom &amp; Localised Error Messages with Joi</h1>
    <section class="article-details">
        <div class="article-details-item">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
    <path fill="currentColor" d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
    <path fill="none" d="M0 0h24v24H0z"/>
</svg>

            <time pubdate datetime="Fri May 04 2018 03:00:00 GMT+0300 (Eastern European Summer Time)">4 May 2018</time>
        </div>
        <div class="article-details-item">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
  <path fill="currentColor" fill-opacity=".9" fill-rule="evenodd" d="M10 0C4.5 0 0 4.5 0 10s4.5 10 10 10 10-4.5 10-10S15.5 0 10 0Zm0 18c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8Zm.5-13H9v6l5.2 3.2.8-1.3-4.5-2.7V5Z"/>
</svg>
            <span>11 min. read</span>
        </div>
        
    </section>
    <p>In my previous article, <a href="/articles/what-ive-learned-validating-with-joi/">What I've Learned Validating with Joi</a>, I detailed general form validation that plays to the strengths of Joi in my latest project. But an area of weakness in the library is one I had set out to tackle since - displaying custom internationalisation (i18n) error messages.</p>
<p>First, there are libraries like <a href="https://github.com/dialexa/relish">Relish</a> that help address this issue but I believed there was a solution without bringing in another library. I set out to rewrite the project's validation from scratch for two reasons; 1) to simplify logic that was becoming a challenge to scale and 2) gain a deeper understanding of Joi and how it can be used.</p>
<hr>
<p>So where do you even start? I started with the most minimalist approach that mimicked the project's current implementation. I wanted to validate one small piece of data to create an error so I could review the raw data returned from Joi.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> Joi <span class="token keyword">from</span> <span class="token string">"joi-browser"</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">age</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>Joi<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> schema<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>When that validation failed, Joi returned an object with four properties, <code>catch</code>, <code>error</code>, <code>then</code>, and <code>value</code>. The two important properties here are <code>error</code>, which contains all the relevant error data, and <code>value</code>, which contains the original data source. That's good to verify that the data you're validating is what you're expecting. We will focus on the <code>error</code> object though.</p>
<p>When you expand the <code>error</code> object you find a few more properties but we will focus immediately on <code>details</code>, an array containing each individual error object.</p>
<p>Let's dig into the <code>details</code> error object from the validation above.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*F4EHaStMkOtXFLyCVNGKnw.png" alt="Raw error object returned from Joi"></p>
<p>The object contains a lot of great information. It may not all be useful to us <em>yet</em> but we will soon convert this into data that we can use to achieve our goal of custom i18n error messages.</p>
<p>So what data will be useful for us? Ultimately, what do we need to achieve our goal? The target data I sketched out looked like this:</p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  <span class="token literal-property property">type</span><span class="token operator">:</span> what type <span class="token keyword">of</span> error was thrown<span class="token operator">?</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">field</span><span class="token operator">:</span> what field has the error<span class="token operator">?</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> what error message is shown<span class="token operator">?</span><br><span class="token punctuation">}</span></code></pre>
<p>I wrote that structure down and sought out to build that with the data provided by Joi.</p>
<p>How do we build each property?</p>
<h2>Type</h2>
<p>The <code>type</code> property provided by Joi is vitally important. In the example above it returns <code>number.min</code> which is the validation method that caused the error. The <code>type</code> sent back from Joi directly relates to the error-causing method and, most importantly, is consistent based on the method names.</p>
<p>With this information we can begin to target messages. For example, when there is a <code>number.min</code> error <code>type</code> we could return a message like <em>&quot;Sorry, you must be at least 21 to enter.&quot;</em></p>
<p>But what if there is a field later in the app that requires the user to earn at least $500/month.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">income</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">income</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>When that data is validated it'll also return a <code>number.min</code> error type which would result in the same <em>&quot;Sorry, you must be at least 21 to enter.&quot;</em> That's not what we want. So we need to learn how to target the specific field next.</p>
<h2>Path</h2>
<p>To create the error messages I would need to know for which field the error occurred. In order to do that I had to better understand the <code>path</code> property. This property returns the steps taken within the <code>schema</code>. In our <code>schema</code> above, we only had one level which results in what we see, <code>['age']</code>.</p>
<p>But let's modify our earlier example to demonstrate how the <code>path</code> is generated.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">customer</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">income</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">customer</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">income</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>By updating our structures this error now returns a new <code>path</code> value.</p>
<pre class="language-js"><code class="language-js"><span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"customer"</span><span class="token punctuation">,</span> <span class="token string">"income"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>Ultimately, the value of the <code>path</code> property will be used to determine which field has an error. The <code>path</code> value could be mapped to be useful to us.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> field <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<blockquote>
<p>Also note that if your schema does not have any named properties, the <code>path</code> property will be null.</p>
</blockquote>
<p>If you're certain you won't have any conflicting property names anywhere in the <code>data</code> and <code>schema</code>, you could get by with mapping only the last value of the <code>path</code> array. I prefer to <code>join</code> because, personally, I have to handle validating an array with a variable number of objects.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">movies</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"Halloween"</span><span class="token punctuation">,</span> <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token number">1978</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"The Shining"</span><span class="token punctuation">,</span> <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token number">1980</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">"Sleepaway Camp"</span><span class="token punctuation">,</span> <span class="token literal-property property">year</span><span class="token operator">:</span> <span class="token number">1983</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">movies</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token literal-property property">title</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">year</span><span class="token operator">:</span> Joi<span class="token punctuation">.</span><span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">1979</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>console<span class="token punctuation">.</span><span class="token function">dir</span><span class="token punctuation">(</span>Joi<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">abortEarly</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>In the example above we have three movies listed but we only want movies that were released before the 80's. By default, Joi will escape validation once it hits the first error. To emphasise the point of <code>join</code>ing the <code>path</code> above, we override that functionality by passing in our options object into the <code>validate</code> method.</p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  <span class="token literal-property property">abortEarly</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>The above snippet will return an error object that partially looks like this:</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*1o5YnGejxIRdeE7R5ew8dA.png" alt="Error object from Joi demonstrating multiple error paths"></p>
<p>If you were to always grab the last value of the <code>path</code> property to identify the field with the error, you'd have a conflict here as both errors exist on the <code>year</code> field. By <code>join</code>ing the <code>path</code> array, I can still receive unique identifiers based on their array index.</p>
<pre class="language-bash"><code class="language-bash">movies_1_year<br>movies_2_year</code></pre>
<h3>So what do we have now?</h3>
<p>Now, we have two pieces of valuable information.</p>
<ol>
<li>We have the error type like <code>number.min</code> or <code>number.max</code>.</li>
<li>We have a unique field identifier like <code>age</code> or <code>movies_1_year</code>.</li>
</ol>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'number.min'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">field</span><span class="token operator">:</span> <span class="token string">'age'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">errorMsg</span><span class="token operator">:</span> what error message is shown<span class="token operator">?</span><br><span class="token punctuation">}</span></code></pre>
<p>Next we need to choose the error message based on the previous two pieces of information.</p>
<h2>Message</h2>
<p>While the Joi error object returns a generally suitable error message, our goal is to have messages that we can easily localise and customise. The project where I have implemented this is built on React and translations are handled using <a href="https://github.com/yahoo/react-intl">React-Intl</a> so the examples will be based around that format.</p>
<p>To display a localised message with <code>react-intl</code> I commonly use its <code>FormattedMessage</code> component.</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> FormattedMessage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-intl"</span><span class="token punctuation">;</span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FormattedMessage</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app_continue<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">;</span></code></pre>
<p>From there, the <code>FormattedMessage</code> component will search the current locale's <code>i18n</code> file for the key <code>app_continue</code> and return its value such as <code>Jatkaa</code> in Finnish or <code>Continue</code> in English.</p>
<p>So what we want to get our heads around here is that our <code>message</code> property won't be our <em>message</em> but our <em>message id</em>. We can (and should) rename the property to communicate that in our error object.</p>
<p>For the sake of consistency, we need to define a structure to our <code>i18n</code> error ids. Let's use the following:</p>
<pre class="language-js"><code class="language-js">error<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token constant">FIELD</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token constant">TYPE</span><span class="token punctuation">]</span></code></pre>
<p>If we update our mapped object we can see that we now mapped the data that we need.</p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'number.min'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">field</span><span class="token operator">:</span> <span class="token string">'age'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">errorMsgId</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">error.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>field<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><br><span class="token punctuation">}</span></code></pre>
<p>With that mapped object, we now know which field has an error, which type of error it is, and which message id to show.</p>
<hr>
<p>Let's take a step back now and review our earlier situation with the <code>age</code> and <code>income</code> restriction errors and how our mapped object addresses this.</p>
<p>In our <code>i18n</code> file we could have the following <code>id</code>s:</p>
<p>'error.age.number.min': 'You must be 21 to enter.',<br>
'error.income.number.min': 'You must make at least $500/month'</p>
<p>By using the <code>type</code>, the <code>path</code>, and building our <code>errorMsgId</code> we can now achieve custom localised error message.</p>
<h2>Mapping Our Object</h2>
<p>Okay, so we've covered what we're building and why we're building it. So let's piece it all together by walking through how we can map the Joi error object to our new object.</p>
<pre class="language-js"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">validateData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> schema</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">abortEarly</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> errors <span class="token operator">=</span> Joi<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> schema<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> errors<span class="token punctuation">.</span>error <span class="token operator">?</span> <span class="token function">buildUsefulErrorObject</span><span class="token punctuation">(</span>errors<span class="token punctuation">.</span>error<span class="token punctuation">.</span>details<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token function-variable function">buildUsefulErrorObject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">errors</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> usefulErrors <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  errors<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>usefulErrors<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      usefulErrors<span class="token punctuation">[</span>error<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>        <span class="token literal-property property">type</span><span class="token operator">:</span> error<span class="token punctuation">.</span>type<span class="token punctuation">,</span><br>        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">error.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>      <span class="token punctuation">}</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> usefulErrors<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<h2>Whew!</h2>
<p>That's quite the block of code so let's break it down.</p>
<h3>validateData</h3>
<p>This is the main function I call. This accepts the <code>data</code> and <code>schema</code> arguments. Nothing crazy happens here as I then send them into <code>Joi.validate()</code> and store the results in the <code>errors</code> constant. If that contains any errors then we go into our mapping process.</p>
<h3>buildUsefulErrorObject</h3>
<p>This is where the magic happens. The function checks to see if the <code>usefulErrors</code> object contains the error key already, if not, it creates it and builds the content. If the key already exists, it skips it which again shows some value in <code>join</code>ing the <code>path</code> names as the field identifier.</p>
<p>Using the <code>age</code> and <code>income</code> errors from above, let's see how our <code>usefulErrors</code> object would look.</p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'number.min'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'error.age.number.min'</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">income</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'number.min'</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'error.income.number.min'</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Ultimately, this is the object I return back to my app and store in my <code>invalidFields</code> state property.</p>
<h2>Displaying the Error Messages</h2>
<p>With that object stored in the state, it can be used to show error messages in the app with the following methods:</p>
<pre class="language-js"><code class="language-js"><span class="token function">isInvalid</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>data<span class="token punctuation">.</span>invalidFields<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token function">getErrorLabelKey</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>data<span class="token punctuation">.</span>invalidFields<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">?</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>data<span class="token punctuation">.</span>invalidFields<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>msg <span class="token operator">:</span><br>    <span class="token string">''</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Using those methods, an error message can be displayed by checking to see if that field's name exists as a key in our <code>invalidFields</code> object (<code>isInvalid</code>) and then grabbing the correct message (<code>getErrorLabelKey</code>).</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>error-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text"><br>  </span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isInvalid</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span> <span class="token operator">?</span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FormattedMessage</span></span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getErrorLabelKey</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span> <span class="token operator">:</span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">/></span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token plain-text"><br></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<hr>
<p>It's not the most direct solution. I understand that. But rewriting my project's validation allowed me to solve the problem of custom localised error messages while gaining a better understanding of Joi. This provides flexibility and the ability to scale as the forms and their validation grow.</p>
<p>Given how frequently I see this issue arise, I am hoping this post can help others dealing with the same challenge.</p>

</article>

<div class="back-to-top-wrapper">
    <button class="back-to-top-container" type="button" onclick="goToTop()" title="Float back to the top of the page.">
        <svg width="64px" height="64px" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--emojione" preserveAspectRatio="xMidYMid meet"><path d="M52 22.5c0 11.3-8.8 24.4-19.8 24.4c-10.9 0-19.8-13-19.8-24.4C12.5 11.2 21.3 2 32.2 2C43.2 2 52 11.2 52 22.5" fill="#ed4c5c"></path><g fill="#94989b"><path d="M31.5 49.1V49v.1"></path><path d="M31.6 49.2c-.1 0-.1-.1 0 0"></path></g><path d="M33 49.2h-1.5c0 1.8-.4 3.9-1.9 5.2c-2.1 1.8-4.9.7-7.4.6c-3-.1-5.6 1.2-7.7 3.2c-.8.7-1.6 1.7-2.3 2.5c-.8.9.3 1.9 1.1 1c1.5-1.8 2.6-3.1 4.6-4.3c2.6-1.5 5-.7 7.8-.6c3.2.2 6.1-1.4 7-4.7c.2-.7.3-2 .3-2.9" fill="#b2c1c0"></path><path d="M31.5 49c0-.1 0 0 0 0" fill="#94989b"></path><path d="M30.8 48h2.9c.9 0 .9-1.3 0-1.3h-2.9c-.9.1-.9 1.3 0 1.3" fill="#b2c1c0"></path><path d="M30.1 50h4.3c1.4 0 1.4-1.9 0-1.9h-4.3c-1.4-.1-1.4 1.9 0 1.9" fill="#ed4c5c"></path></svg>
        <i class="pennywise" role="presentation"><svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 48 48" width="48px" height="48px"><path fill="#b0bec5" d="M40,31.034C40,23.302,32.837,18,24,18S8,23.302,8,31.034S15.163,46,24,46S40,38.766,40,31.034z"/><path fill="#78909c" d="M39.812 33.159c-.207 1.274-.612 2.52-1.186 3.698L24 32.483 39.812 33.159zM24 32.483l-5.28 12.629c-1.449-.502-2.814-1.207-4.038-2.066L24 32.483zM33.318 43.046c-1.224.859-2.588 1.564-4.038 2.066L24 32.483 33.318 43.046zM24 32.483L9.374 36.857c-.574-1.178-.979-2.423-1.186-3.698L24 32.483z"/><path fill="#e65100" d="M43.603,21.188c1.94-0.669,2.397-4.46,2.397-4.46c-2.9,1.418-4.831,0-5.792-2.676 c-3.221-8.92-13.422-8.028-13.422-8.028h-1.83h-3.992c0,0-9.133-0.892-12.646,8.028C7.27,16.728,5.164,18.147,2,16.728 c0,0,0.499,3.791,2.615,4.46c-0.998,0.553-1.737,0-2.366-0.339C2.25,26.54,7.21,31,12.54,31h12.417h11.382 c4.886,0,9.433-4.46,9.433-10.151C45.195,21.188,44.518,21.741,43.603,21.188z"/><path fill="#ef6c00" d="M21.007,12.077c0,0-6.085-5.538,3.043-11.077c0,0-0.677,1.236,0.68,2.885 c0.309-0.57,1.25-1.038,1.25-1.038s0.347,2.247,1.113,2.769c4.057,2.769,0.31,6.144,0.31,6.144S25.98,13,23.98,13 S21.007,12.077,21.007,12.077z"/><path fill="#e0e0e0" d="M12,17.111C12,13.656,14.289,10,18,10c2.571,0,4.474,1.778,6,1.778S27.429,10,30,10 c3.711,0,6,3.656,6,7.111c0,4.571-0.857,6.222-1.92,8.456c-0.851,1.79,0,3.459,0,5.189s-1.4,3.497-1.92,4.324 C30.72,37.37,30.24,42,25.44,42c0,0-2.16,0-2.88,0c-4.8,0-5.28-4.739-6.72-6.919c-0.54-0.817-1.92-2.595-1.92-4.324 c0-1.714,0.851-3.399,0-5.189C12.857,23.333,12,21.683,12,17.111z"/><path fill="#d32f2f" d="M20.238,35.712C21.375,37.125,21,40,23.998,40c3.002,0,2.627-2.875,3.76-4.288 C24,37,24,37,20.238,35.712z"/><path fill="#bf360c" d="M30.302,30.917C30,30.38,29.657,29.771,29.35,28.844c-0.043-0.131-0.08-0.304-0.115-0.511 l-0.986,0.166c0.044,0.266,0.096,0.489,0.152,0.658c0.337,1.021,0.721,1.702,1.03,2.25c0.343,0.609,0.57,1.012,0.57,1.567 c0,0.72-0.508,1.15-1,1.15c-0.591,0-1.231,0.096-1.78,0.635c-0.409,0.402-0.873,0.739-1.421,0.908C25.212,35.85,24.58,36,24,36 s-1.212-0.15-1.799-0.331c-0.548-0.169-1.012-0.506-1.421-0.908c-0.548-0.539-1.189-0.635-1.78-0.635c-0.485,0-1-0.395-1-1.125 c0-0.521,0.221-0.904,0.556-1.486c0.33-0.574,0.741-1.288,1.05-2.377c0.047-0.167,0.092-0.389,0.132-0.653l-0.988-0.15 c-0.033,0.214-0.067,0.395-0.106,0.53c-0.275,0.971-0.636,1.598-0.955,2.151C17.319,31.657,17,32.213,17,33 c0,1.33,1.017,2.125,2,2.125c0.875,0,1.175,0.541,1.238,0.587C22,37,23.002,37.25,24,37.25c1.002,0,2-0.25,3.758-1.538 c0.061-0.044,0.367-0.587,1.242-0.587c0.983,0,2-0.805,2-2.15C31,32.157,30.676,31.582,30.302,30.917z"/><path fill="#bf360c" d="M26.812 31c0 0 .188.536.188.857 0 .75-.502 1.286-1.125 1.286-.188 0-.36-.06-.51-.146C25.125 33.589 24.607 34 24 34s-1.125-.411-1.365-1.003c-.15.086-.322.146-.51.146-.623 0-1.125-.536-1.125-1.286C21 31.536 21.188 31 21.188 31s.375.857 1.312.643c.469-.107 1.031.214 1.5.214s1.031-.321 1.5-.214C26.438 31.857 26.812 31 26.812 31zM19 27l.25-3.5c.076-1.165.122-2.329.184-3.5.104 1.162.226 2.331.316 3.5L20 27H19zM28 27l.25-3.5c.076-1.165.122-2.329.184-3.5.104 1.162.226 2.331.316 3.5L29 27H28z"/><g><path fill="#212121" d="M31.99 26.13C30.34 31.2 26 28.01 26 28.01c.44-.21.9-.55 1.32-.93 1.05-.93 1.91-2.08 1.91-2.08.67 0 1.18.05 1.57.13C32.17 25.43 31.99 26.13 31.99 26.13zM16.233 26.13c1.833 5.07 6.656 1.88 6.656 1.88-.489-.21-1-.55-1.467-.93C20.256 26.15 19.3 25 19.3 25c-.744 0-1.311.05-1.744.13C16.033 25.43 16.233 26.13 16.233 26.13z"/></g><g><path fill="#fafafa" d="M30.13 27.57c-1.77 1.16-2.75-.32-2.75-.32s.3-.3.65-.64c.39-.37.86-.78 1.09-.86.17-.06.38-.08.6-.06.34.01.68.11.85.25C31.12 26.38 30.62 27.25 30.13 27.57zM18.3 27.57c1.967 1.16 3.056-.32 3.056-.32s-.333-.3-.722-.64c-.433-.37-.956-.78-1.211-.86-.189-.06-.422-.08-.667-.06C18.378 25.7 18 25.8 17.811 25.94 17.2 26.38 17.756 27.25 18.3 27.57z"/></g><g><path fill="#827717" d="M30 26.38c0 .55-.45 1-1 1-.47 0-.87-.33-.97-.77.39-.37.86-.78 1.09-.86.17-.06.38-.08.6-.06C29.89 25.87 30 26.11 30 26.38zM18.444 26.38c0 .55.5 1 1.111 1 .522 0 .967-.33 1.078-.77-.433-.37-.956-.78-1.211-.86-.189-.06-.422-.08-.667-.06C18.567 25.87 18.444 26.11 18.444 26.38z"/></g><g><path fill="#212121" d="M25.004 25.507c.098.548.19 1.102.378 1.579.18.496.524.633.876.492.381-.156.799-.495 1.168-.858.381-.362.751-.749 1.112-1.155l1.141-1.198c.422-.394.696-.749 1.191-1.197.517-.431 1.244-.563 1.845-.373.608.189 1.045.65 1.286 1.151-.418-.371-.895-.648-1.384-.67-.48-.041-.928.155-1.224.471-.268.345-.671.864-1.018 1.26l-1.101 1.232c-.386.403-.779.813-1.221 1.185-.455.353-.912.744-1.597.903-.331.087-.792.024-1.076-.229-.134-.111-.259-.257-.336-.428-.077-.161-.107-.312-.135-.462C24.834 26.617 24.884 26.058 25.004 25.507zM23.5 26.5c.181.221.333.467.396.785.029.156.039.362-.106.572-.124.155-.242.249-.404.346-.324.181-.716.183-1.031.115-.321-.069-.608-.187-.862-.334-1.026-.574-1.818-1.37-2.585-2.125-.381-.386-.769-.757-1.14-1.161l-.553-.616c-.19-.23-.292-.352-.492-.487C15.98 23.069 14.824 23.21 14 23.949c.268-.479.711-.893 1.277-1.102.562-.204 1.236-.19 1.812.098.279.124.575.38.745.553l.579.548c.402.355.792.736 1.186 1.107.784.748 1.516 1.524 2.341 2.089C22.73 27.828 23.746 27.891 23.5 26.5z"/></g></svg></i>
    </button>
</div></main>
      <footer class="primary-footer">
  <q>I live my life one hot chocolate at a time.</q>
  <span>Daniel Yuschick © 2022</span>
</footer>
    </div>
    
      <script src="/js/main.js"></script>
    
  </body>
</html>